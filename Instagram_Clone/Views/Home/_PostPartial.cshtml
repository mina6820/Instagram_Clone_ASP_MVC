@model List<PostViewModel>?

@*
    For more information on enabling MVC for empty projects, visit http://go.microsoft.com/fwlink/?LinkID=397860
*@

@model List<PostViewModel>

<input type="hidden" id="hiddenID" value="@ViewBag.CurrentUserId" />
@foreach (var post in ViewBag.postsList)@* postsListByDescending(post => post.CreatedAt) *@
{
    
    <div class="post">
        <div class="info">
            <div class="person">
                @if(post.ProfilePhoto == null)
                {
                    <img src="https://i.ibb.co/3S1hjKR/account1.jpg">
                }
                else
                {
                    <img  src="~/images/@post.ProfilePhoto.Name"/>
                }
                

                <a href="#">@post.UserName</a>
                <span class="circle">.</span>
                <span>@post.TimeAgo</span>
            </div>
            <div class="more">
                <img src="./images/show_more.png" alt="show more">
            </div>
        </div>
        <div class="image">
            @if (post.ImagesNames != null)
            {
                @foreach (var photo in post.ImagesNames)
                {
                    if (photo == null)
                    {
                        <img src="https://i.ibb.co/Jqh3rHv/img1.jpg">
                    }
                    else
                    {
                        <img src="~/images/@photo">
                    }
                }
            }
            else
            {
                <img src="https://i.ibb.co/Jqh3rHv/img1.jpg">
            }
        </div>

        <div class="desc">
            <div class="icons">
                <div class="icon_left d-flex">
                    @* <div class="like">
                        <img class="not_loved" src="./images/love.png">
                        <img class="loved" src="./images/heart.png">
                    </div> *@

                    <button style="background-color:transparent;border:none;" class="like" onclick="Like(@post.ID)">
                        <img class="not-loved" id="not-Loved-@post.ID" src="./images/love.png">
                        <img class="loved" id="loved-@post.ID" src="./images/heart.png">
                    </button>

                    <div class="chat">
                        <button type="button" class="btn p-0" onclick="comment(@post.ID)" data-bs-toggle="modal" data-bs-target="#message_modal">
                            <img src="./images/bubble-chat.png">
                        </button>
                    </div>
                    <div class="send">
                        <button type="button" class="btn p-0" data-bs-toggle="modal" data-bs-target="#send_message_modal">
                            <img src="./images/send.png">
                        </button>
                    </div>
                </div>
                <div class="save not_saved">
                    <img class="hide saved" src="./images/save_black.png">
                    <img class="not_saved" src="./images/save-instagram.png">
                </div>
            </div>
            <div class="liked">
                <a class="bold" id="likedCount-@post.ID" href="#">@post.Likes.Count <span>Likes</span></a>
            </div>
            <div class="post_desc">
                <p>
                    <a class="bold" href="#">@post.UserName</a>
                        @post.Caption
                    </p>
                    <p><a class="gray" href="#">View all 2 comments</a></p>
                    <input type="text" placeholder="Add a comments...">
                </div>
            </div>
        </div>
    }

    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.12/signalr.min.js"></script>

    <script>
        var currentUserID = document.getElementById("hiddenID").value;
        console.log(`the ID =  ${currentUserID}`);
        var hub = new signalR.HubConnectionBuilder().withUrl("/PostH").build();

        hub.start().then(function () {
            console.log("success");
        });

        function Like(postID) {
            var imgElement = document.getElementById(`not-Loved-${postID}`)
            if (!imgElement.classList.contains("hide_img")) {
                hub.invoke("AddLike", postID, currentUserID);
            }
            else {
                hub.invoke("DeleteLike", postID, currentUserID);
            }

        }

    hub.on("ReceiveLikes", function (postID, likesCount) {
        var element = document.getElementById(`likedCount-${postID}`);
        element.textContent = likesCount + " Likes" ;
    })


    function comment(postId){
       
            $.ajax({
                url: "/Post/Comment",
                success: function () {
                    console.log("successhdhdh");

                },
            data: { PostID: postId }
            });
        
    }

</script>

