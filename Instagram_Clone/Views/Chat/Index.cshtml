@model List<Instagram_Clone.Models.Message>

<!DOCTYPE html>
<html>
<head>
    <title>Chat</title>
    <!-- Include the SignalR library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/5.0.8/signalr.min.js"></script>
</head>
<body>
    <h1>Chat</h1>

    <div id="messageContainer">
        @foreach (var message in Model.OrderBy(m => m.Date))
        {
            <div>
                <strong>@message.Sender.UserName:</strong>
                <span>@message.Content</span>
            </div>
        }
    </div>

    <!-- Your form for sending messages can be added here -->
    <form id="messageForm">
        <input type="text" id="messageInput" />
        <button type="button" onclick="sendMessage()">Send</button>
    </form>

    <script>
        // Establish a connection to the SignalR hub
        var connection = new signalR.HubConnectionBuilder()
            .withUrl("/chat/index")
            .build();

        connection.start().then(function () {
            console.log("SignalR Connected");
        }).catch(function (err) {
            console.error("SignalR Connection Error: " + err);
        });

        // Function to send a message
        function sendMessage() {
            var messageInput = document.getElementById("messageInput").value;
            var receiverId = @Model[0].RecieverId;

            connection.invoke("SendMessage", messageInput, receiverId)
                .catch(function (err) {
                    console.error("Error sending message: " + err);
                });
        }

        // Receive message from the server
        connection.on("ReceiveMessage", function (message) {
            // Handle received message
            console.log("Received message:", message);
        });
    </script>
</body>
</html>
